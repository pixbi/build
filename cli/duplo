#!/usr/bin/env bash

dir="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

if [ "$2" ]; then
  cwd="$( cd "$2" && pwd )"
else
  cwd="$(pwd)"
fi

duploGlobal="$dir/../lib/node_modules/duplo"
if [ -d "$duploGlobal" ]; then
  duplo="$( cd $duploGlobal && pwd )"
else
  duplo="$( cd "$dir/.." && pwd )"
fi

grunt="$duplo/node_modules/grunt-cli/bin/grunt"
gruntfile="$duplo/cli/Gruntfile.coffee"
run="$grunt --base $duplo --gruntfile $gruntfile"

case "$1" in
  dev)
    if [ -z "$NODE_ENV" ]; then
      NODE_ENV="dev"
    fi

    CWD=$cwd NODE_ENV=$NODE_ENV BUILD_MODE=dev $run dev:root
    ;;

  build)
    if [ -z "$NODE_ENV" ]; then
      NODE_ENV="prod"
    fi

    CWD=$cwd NODE_ENV=$NODE_ENV BUILD_MODE=dev $run build:root
    ;;

  buildDep)
    if [ -z "$NODE_ENV" ]; then
      NODE_ENV="prod"
    fi

    CWD=$cwd NODE_ENV=$NODE_ENV BUILD_MODE=dev $run build
    ;;

  patch)
    CWD=$cwd $run release:patch
    ;;

  minor)
    CWD=$cwd $run release:minor
    ;;

  major)
    CWD=$cwd $run release:major
    ;;

  *)
esac
